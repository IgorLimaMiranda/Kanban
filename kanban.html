<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <title>Kanban</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            overflow: hidden;
        }

        main {
            display: flex;
            flex-direction: row;
            gap: 20px;
            overflow-x: auto;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .coluna {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: 250px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px);
            /* altura fixa com base no viewport */
            box-sizing: border-box;
        }

        h2 {
            margin-top: 0;
            color: #333;
            flex-shrink: 0;
        }

        .card {
            background-color: #eaeaea;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            flex-shrink: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .add-btn {
            margin-top: auto;
            padding: 8px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .add-btn:hover {
            background-color: #0056b3;
        }

        .card-input {
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .cards-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
        }


        @media (max-width: 600px) {
            main {
                padding: 10px;
                gap: 10px;
            }

            .coluna {
                width: 200px;
                padding: 10px;
            }

            .card {
                font-size: 14px;
                padding: 8px;
            }

            h2 {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
    <main>
        <div class="coluna">
            <h2>A Fazer</h2>
            <div class="cards-container"></div>
            <!-- <div class="card">Revisar documento do projeto</div> -->
            <button class="add-btn">+ Adicionar</button>
        </div>

        <div class="coluna">
            <h2>Fazendo</h2>
            <div class="cards-container"></div>
            <!-- <div class="card">Implementar layout responsivo</div> -->
            <button class="add-btn">+ Adicionar</button>
        </div>

        <div class="coluna">
            <h2>Feito</h2>
            <div class="cards-container"></div>
            <!-- <div class="card">Criar repositório no GitHub</div> -->
            <button class="add-btn">+ Adicionar</button>
        </div>
    </main>

    <script>
        $(function () {
            // Limpa cards existentes antes de carregar
            $('.coluna').each(function () {
                $(this).find('.card').remove();
            });

            // Carregar cards salvos
            if (localStorage.getItem('kanban')) {
                const dados = JSON.parse(localStorage.getItem('kanban'));
                $('.coluna').each(function (index) {
                    const $coluna = $(this);
                    const cards = dados[index] || [];
                    cards.forEach(texto => {
                        const $card = criarCard(texto);
                        $coluna.find('.cards-container').append($card);
                    });
                });
            }

            // Adicionar novo card
            $('.add-btn').on('click', function () {
                const $coluna = $(this).parent();

                // Evita múltiplos inputs abertos
                if ($coluna.find('.card-input').length > 0) return;

                const $input = $(`
                                  <textarea class="card-input" placeholder="Digite o conteúdo..." rows="2" style="
                                    resize: none;
                                    min-height: 60px;
                                    max-height: 200px;
                                    width: 100%;
                                    box-sizing: border-box;
                                    font-family: Arial, sans-serif;
                                    font-size: 14px;
                                    padding: 10px;
                                    border: 1px solid #ccc;
                                    border-radius: 6px;
                                    white-space: pre-wrap;
                                    word-break: break-word;
                                    overflow-y: auto;
                                  "></textarea>
                                `);



                $input.on('input', function () {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });

                const $saveBtn = $(`
                  <button style="
                    background-color: #28a745;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    padding: 6px 12px;
                    cursor: pointer;
                    flex: 1;
                  ">✅ Salvar</button>
                `);

                const $cancelBtn = $(`
                  <button style="
                    background-color: #dc3545;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    padding: 6px 12px;
                    cursor: pointer;
                    flex: 1;
                  ">❌ Cancelar</button>
                `);

                const $buttonRow = $('<div style="display: flex; gap: 10px; margin-top: 6px;"></div>');
                $buttonRow.append($saveBtn).append($cancelBtn);

                const $inputGroup = $('<div style="margin-bottom: 10px;"></div>');
                $inputGroup.append($input).append($buttonRow);
                $inputGroup.insertBefore($(this));
                $input.focus();

                // Criar card com Enter (sem Shift)
                $input.on('keydown', function (e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        const texto = $(this).val().trim();
                        if (texto !== '') {
                            const $novoCard = criarCard(texto);
                            $novoCard.insertBefore($inputGroup);
                            $inputGroup.remove();
                            salvarCards();
                        }
                    } else if (e.key === 'Escape') {
                        $inputGroup.remove();
                    }
                });

                // Botão salvar
                $saveBtn.on('click', function () {
                    const texto = $input.val().trim();
                    if (texto !== '') {
                        const $novoCard = criarCard(texto);
                        $novoCard.insertBefore($inputGroup);
                        $inputGroup.remove();
                        salvarCards();
                    }
                });

                // Botão cancelar
                $cancelBtn.on('click', function () {
                    $inputGroup.remove();
                });
            });

            // Criar card com botão de apagar e edição
            function criarCard(texto) {
                const $card = $('<div class="card" style="display: flex; align-items: center;"></div>');
                const $textSpan = $('<span style="flex: 1; word-break: break-word; white-space: pre-wrap;"></span>').text(texto);
                const $deleteBtn = $(`
                                      <button style="
                                        background: none;
                                        border: none;
                                        font-size: 16px;
                                        cursor: pointer;
                                        margin-left: auto;
                                        padding: 0;
                                      ">🗑️</button>
                                    `);

                $card.append($textSpan).append($deleteBtn);

                // Editar com duplo clique
                $card.on('dblclick', function () {
                    const valorAtual = $(this).contents().filter(function () {
                        return this.nodeType === 3;
                    }).text().trim();

                    const $input = $('<input type="text" class="card-input">').val(valorAtual).css({
                        width: '100%',
                        padding: '8px',
                        border: '1px solid #ccc',
                        borderRadius: '6px',
                        boxSizing: 'border-box'
                    });

                    $(this).replaceWith($input);
                    $input.focus();

                    $input.on('keydown', function (e) {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            const novoTexto = $(this).val().trim();
                            if (novoTexto !== '') {
                                const $novoCard = criarCard(novoTexto);
                                $novoCard.insertBefore($(this));
                                $(this).remove();
                                salvarCards();
                            }
                        } else if (e.key === 'Escape') {
                            const $restaurado = criarCard(valorAtual);
                            $restaurado.insertBefore($(this));
                            $(this).remove();
                        }
                    });
                });

                // Excluir card
                $deleteBtn.on('click', function (e) {
                    e.stopPropagation();
                    $card.remove();
                    salvarCards();
                });

                return $card;
            }

            // Salvar cards no localStorage
            function salvarCards() {
                const dados = [];
                $('.coluna').each(function () {
                    const cards = [];
                    $(this).find('.card').each(function () {
                        const texto = $(this).find('span').text().trim();
                        if (texto !== '') {
                            cards.push(texto);
                        }
                    });
                    dados.push(cards);
                });
                localStorage.setItem('kanban', JSON.stringify(dados));
            }
        });
    </script>
</body>

</html>